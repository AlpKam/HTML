import React, { useState, useEffect, useRef } from 'react';
import { Info, AlertTriangle, Activity, X, Globe, Map as MapIcon, Layers, Clock, AlertOctagon, FileText } from 'lucide-react';

// --- VERİ SETLERİ ---

// 1. ANA TEKTONİK LEVHA SINIRLARI VE FAY HATLARI
const faultLines = [
  // --- TÜRKİYE VE YAKIN ÇEVRE ---
  {
    id: 'kaf',
    name: 'Kuzey Anadolu Fay Hattı (KAF)',
    type: 'Doğrultu Atımlı',
    color: '#ef4444',
    region: 'Türkiye',
    description: 'Dünyanın en aktif sağ yanal atımlı faylarından biri. Bingöl\'den Saros Körfezi\'ne uzanır.',
    coordinates: [
      [39.3, 41.0], [39.5, 40.0], [39.8, 39.0], [40.0, 38.0], [40.2, 37.0], 
      [40.5, 36.0], [40.7, 35.0], [40.8, 34.0], [40.9, 33.0], [40.8, 32.0], 
      [40.7, 31.0], [40.7, 30.0], [40.8, 29.0], [40.7, 28.0], [40.5, 27.0], [40.3, 26.0]
    ]
  },
  {
    id: 'daf',
    name: 'Doğu Anadolu Fay Hattı (DAF)',
    type: 'Sol Yanal Atımlı',
    color: '#f97316',
    region: 'Türkiye',
    description: 'Arap Levhası ile Anadolu Levhası arasındaki sınır.',
    coordinates: [
      [36.2, 36.1], [36.5, 36.3], [37.0, 36.8], [37.5, 37.2], [38.0, 38.0], 
      [38.4, 39.2], [38.8, 40.0], [39.3, 41.0]
    ]
  },
  {
    id: 'baf',
    name: 'Batı Anadolu Graben Sistemi',
    type: 'Normal Faylar',
    color: '#eab308',
    region: 'Türkiye',
    description: 'Ege bölgesindeki açılma rejimine bağlı çoklu kırıklar.',
    coordinates: [
      [[38.5, 27.0], [38.5, 29.0]], 
      [[37.8, 27.2], [37.8, 29.1]], 
      [[39.0, 26.5], [39.0, 28.0]], 
      [[36.8, 27.5], [37.0, 28.5]]
    ]
  },
  {
    id: 'dead_sea',
    name: 'Ölü Deniz Fayı',
    type: 'Doğrultu Atımlı',
    color: '#f97316',
    region: 'Orta Doğu',
    description: 'Kızıldeniz\'den başlayıp Türkiye\'nin güneyine (DAF) uzanan hat.',
    coordinates: [
      [29.5, 35.0], [31.0, 35.5], [33.0, 35.5], [34.5, 36.0], [36.2, 36.1]
    ]
  },

  // --- DÜNYA GENELİ ---
  {
    id: 'san_andreas',
    name: 'San Andreas Fayı',
    type: 'Doğrultu Atımlı',
    color: '#8b5cf6',
    region: 'ABD (Kaliforniya)',
    description: 'Pasifik ve Kuzey Amerika levhaları arasındaki ünlü sınır.',
    coordinates: [
       [40.0, -124.0], [38.0, -123.0], [36.0, -121.0], [34.0, -118.0], [33.0, -116.0], [31.0, -114.0]
    ]
  },
  {
    id: 'cascadia',
    name: 'Cascadia Yitim Zonu',
    type: 'Yitim Zonu',
    color: '#d946ef',
    region: 'Kanada/ABD',
    description: 'Juan de Fuca levhasının Kuzey Amerika altına daldığı yer.',
    coordinates: [
      [50.0, -128.0], [48.0, -126.0], [45.0, -125.0], [40.0, -124.0]
    ]
  },
  {
    id: 'aleutian',
    name: 'Aleut Çukuru',
    type: 'Yitim Zonu',
    color: '#ef4444',
    region: 'Alaska',
    description: 'Alaska açıklarından Rusya\'ya uzanan büyük deprem kuşağı.',
    coordinates: [
      [55.0, -160.0], [53.0, -170.0], [52.0, -180.0], [52.0, 170.0], [54.0, 160.0]
    ]
  },
  {
    id: 'chile_peru',
    name: 'Peru-Şili Çukuru (Andes)',
    type: 'Yitim Zonu',
    color: '#ef4444',
    region: 'Güney Amerika',
    description: 'Dünyanın en büyük depremlerini üreten Nazca yitim zonu.',
    coordinates: [
      [0.0, -80.0], [-10.0, -78.0], [-20.0, -72.0], [-33.0, -73.0], [-40.0, -75.0], [-55.0, -70.0]
    ]
  },
  {
    id: 'japan_trench',
    name: 'Japonya ve Kuril Çukuru',
    type: 'Yitim Zonu',
    color: '#ef4444',
    region: 'Japonya',
    description: 'Pasifik levhasının Japonya altına daldığı, tsunamilerin kaynağı.',
    coordinates: [
      [50.0, 160.0], [45.0, 150.0], [40.0, 144.0], [35.0, 141.0], [30.0, 138.0]
    ]
  },
  {
    id: 'philippines',
    name: 'Filipinler Levha Sınırı',
    type: 'Karmaşık',
    color: '#ef4444',
    region: 'Güneydoğu Asya',
    description: 'Filipinler ve Tayvan çevresindeki yoğun sismik bölge.',
    coordinates: [
      [25.0, 122.0], [20.0, 121.0], [15.0, 120.0], [10.0, 126.0], [5.0, 128.0]
    ]
  },
  {
    id: 'indonesia_sunda',
    name: 'Sunda Yayı (Endonezya)',
    type: 'Yitim Zonu',
    color: '#ef4444',
    region: 'Endonezya',
    description: '2004 Hint Okyanusu depreminin kaynağı.',
    coordinates: [
      [10.0, 95.0], [5.0, 95.0], [0.0, 97.0], [-5.0, 102.0], [-8.0, 110.0], [-8.0, 120.0]
    ]
  },
  {
    id: 'himalaya',
    name: 'Himalaya Ön Cephesi',
    type: 'Çarpışma Zonu',
    color: '#ef4444',
    region: 'Asya',
    description: 'Hindistan\'ın Asya\'ya çarpmasıyla oluşan kıtasal çarpışma hattı.',
    coordinates: [
      [34.0, 73.0], [32.0, 76.0], [29.0, 80.0], [27.0, 88.0], [27.0, 95.0]
    ]
  },
  {
    id: 'alpine_nz',
    name: 'Alpine Fayı',
    type: 'Doğrultu Atımlı',
    color: '#10b981',
    region: 'Yeni Zelanda',
    description: 'Güney Adası boyunca uzanan ana kırık.',
    coordinates: [
      [-40.0, 174.0], [-42.0, 172.0], [-44.0, 168.0], [-46.0, 166.0]
    ]
  },
  {
    id: 'mid_atlantic',
    name: 'Atlantik Ortası Sırtı',
    type: 'Okyanus Ortası Sırtı',
    color: '#3b82f6',
    region: 'Atlantik Okyanusu',
    description: 'Kuzey ve Güney Amerika\'yı Avrupa ve Afrika\'dan ayıran devasa su altı dağ sırası.',
    coordinates: [
      [80.0, 0.0], [70.0, -10.0], [60.0, -30.0], [50.0, -30.0], [40.0, -30.0],
      [30.0, -40.0], [20.0, -45.0], [10.0, -40.0], [0.0, -25.0], 
      [-10.0, -15.0], [-20.0, -12.0], [-30.0, -15.0], [-40.0, -15.0], [-50.0, -10.0]
    ]
  }
];

// 2. RİSKLİ SİSMİK BOŞLUKLAR
const seismicGaps = [
  {
    id: 'gap_marmara',
    name: 'Marmara Denizi Segmenti (KAF)',
    riskLevel: 'Kritik',
    probability: '%60+ (30 Yıl)',
    region: 'Türkiye',
    description: 'İstanbul açıklarında beklenen büyük kırılma.',
    status: '1766\'dan beri büyük enerji boşalımı olmadı.',
    coordinates: [[40.75, 29.5], [40.8, 29.0], [40.85, 28.5], [40.85, 28.0], [40.8, 27.5]]
  },
  {
    id: 'gap_nankai',
    name: 'Nankai Çukuru',
    riskLevel: 'Çok Yüksek',
    probability: '%70-80',
    region: 'Japonya',
    description: 'Japonya güneyinde beklenen mega deprem.',
    status: 'Son aktivite 1940\'lar. Periyodik süre dolmak üzere.',
    coordinates: [[34.0, 138.0], [33.0, 136.0], [32.0, 134.0], [31.5, 132.0]]
  },
  {
    id: 'gap_cascadia',
    name: 'Cascadia (The Big One)',
    riskLevel: 'Kritik',
    probability: '%30 (M8+)',
    region: 'ABD',
    description: 'Kuzey Amerika batı kıyısında beklenen mega deprem.',
    status: 'Son deprem 1700. Enerji birikimi maksimum.',
    coordinates: [[50.0, -128.0], [48.0, -126.0], [46.0, -125.0], [44.0, -125.0], [40.5, -124.5]]
  },
  {
    id: 'gap_himalaya',
    name: 'Merkezi Himalaya Boşluğu',
    riskLevel: 'Yüksek',
    probability: 'Belirsiz',
    region: 'Nepal/Hindistan',
    description: 'Yüzyıllardır kırılmamış devasa bir segment.',
    status: 'M8.5+ potansiyeli taşıyor.',
    coordinates: [[29.0, 80.0], [28.5, 82.0], [28.0, 84.0], [27.8, 86.0]]
  }
];

// 3. TARİHSEL VE GÜNCEL BÜYÜK DEPREMLER
const earthquakes = [
  // --- GÜNCEL / YENİ EKLENENLER ---
  { 
    id: 101, 
    name: 'Kamçatka Depremi', 
    date: '29 Temmuz 2025', 
    magnitude: 8.8, 
    coordinates: [52.50, 160.24], 
    location: 'Kamçatka, Rusya',
    fault: 'Kuril-Kamçatka Çukuru',
    details: '2025 yılında gerçekleşen bu mega deprem (Megathrust), 1952 Severo-Kurilsk depreminden (M9.0) sonra bölgedeki en büyük sismik olaydır. Pasifik Levhasının Okhotsk Levhası altına dalması sonucu oluşmuştur.'
  },
  { 
    id: 102, 
    name: 'Noto Yarımadası Depremi', 
    date: '1 Ocak 2024', 
    magnitude: 7.5, 
    coordinates: [37.50, 137.24], 
    location: 'İşikava, Japonya',
    fault: 'Japon Denizi Doğu Kıyısı Fay Zonu',
    details: 'Sığ ters faylanma sonucu oluşmuştur. Kıyılarda 4 metreye varan zemin yükselmelerine ve Wajima şehrinde büyük yangınlara neden olmuştur.'
  },
  { 
    id: 103, 
    name: 'Hualien Depremi', 
    date: '3 Nisan 2024', 
    magnitude: 7.4, 
    coordinates: [23.82, 121.56], 
    location: 'Hualien, Tayvan',
    fault: 'Boyuna Vadi Fayı (Longitudinal Valley Fault)',
    details: 'Tayvan\'da son 25 yılın en büyük depremidir. Filipinler Deniz Levhası ile Avrasya Levhası arasındaki karmaşık çarpışma zonunda meydana gelmiştir.'
  },

  // --- Türkiye ---
  { 
    id: 1, 
    name: 'Büyük Erzincan Depremi', 
    date: '27 Aralık 1939', 
    magnitude: 7.9, 
    coordinates: [39.77, 39.53], 
    location: 'Erzincan, TR',
    fault: 'Kuzey Anadolu Fay Hattı (KAF)',
    details: 'Türkiye Cumhuriyeti tarihinin en çok can kaybına yol açan depremidir (33.000+ vefat). KAF üzerinde 360 km\'lik bir yüzey kırığı oluşturmuş ve "Deprem Fırtınası" olarak bilinen batıya göç sürecini başlatmıştır.'
  },
  { 
    id: 2, 
    name: 'Gölcük (İzmit) Depremi', 
    date: '17 Ağustos 1999', 
    magnitude: 7.4, 
    coordinates: [40.70, 29.91], 
    location: 'Kocaeli, TR',
    fault: 'KAF - Batı Segmenti',
    details: 'Marmara Bölgesi\'nin sanayi merkezini vuran bu deprem, 45 saniye sürmüş ve resmi rakamlara göre 17.480 can kaybına neden olmuştur. Kuzey Anadolu Fayı\'nın kuzey kolu kırılmıştır.'
  },
  { 
    id: 3, 
    name: 'Düzce Depremi', 
    date: '12 Kasım 1999', 
    magnitude: 7.2, 
    coordinates: [40.82, 31.16], 
    location: 'Düzce, TR',
    fault: 'KAF - Düzce Fayı',
    details: '17 Ağustos depreminden sadece 3 ay sonra, gerilimin doğuya transfer olmasıyla tetiklenmiştir. KAF üzerinde kırılmayan bir segmentin kırılmasıyla oluşmuştur.'
  },
  { 
    id: 4, 
    name: 'Van Depremi', 
    date: '23 Ekim 2011', 
    magnitude: 7.2, 
    coordinates: [38.63, 43.48], 
    location: 'Van, TR',
    fault: 'Bitlis-Zagros Bindirme Kuşağı',
    details: 'Doğrultu atımlı değil, bindirme (sıkışma) mekanizmasıyla oluşan ters fay depremidir. Erciş ilçesinde büyük yıkıma neden olmuştur.'
  },
  { 
    id: 5, 
    name: 'Kahramanmaraş (Pazarcık)', 
    date: '6 Şubat 2023 (04:17)', 
    magnitude: 7.7, 
    coordinates: [37.28, 37.03], 
    location: 'K.Maraş, TR',
    fault: 'Doğu Anadolu Fay Hattı (DAF)',
    details: '"Asrın Felaketi"nin ilk depremidir. DAF\'ın Narlı segmenti ile Erkenek segmenti birlikte kırılmıştır. Yüzyıllardır enerji biriktiren bir hattı kırmıştır.'
  },
  { 
    id: 6, 
    name: 'Kahramanmaraş (Elbistan)', 
    date: '6 Şubat 2023 (13:24)', 
    magnitude: 7.6, 
    coordinates: [38.08, 37.17], 
    location: 'K.Maraş, TR',
    fault: 'Çardak Fayı - Sürgü Fayı',
    details: 'İlk depremden 9 saat sonra, tetiklenme sonucu Doğu Anadolu Fayı\'ndan bağımsız doğu-batı uzanımlı Çardak Fayı üzerinde gerçekleşmiştir. Bu büyüklükte bir artçı değil, bağımsız ikinci bir ana depremdir.'
  },
  
  // --- Güney Amerika ---
  { 
    id: 7, 
    name: 'Büyük Şili (Valdivia) Depremi', 
    date: '22 Mayıs 1960', 
    magnitude: 9.5, 
    coordinates: [-39.8, -73.2], 
    location: 'Şili',
    fault: 'Peru-Şili Çukuru (Nazca Yitim Zonu)',
    details: 'Aletsel dönemde (sismografların icadından beri) kaydedilmiş EN BÜYÜK depremdir. Yaklaşık 1000 km\'lik bir fay hattı kırılmıştır. Oluşan tsunami Pasifik Okyanusu\'nu aşarak Japonya ve Hawaii\'de hasara yol açmıştır.'
  },
  { 
    id: 9, 
    name: 'Ekvador-Kolombiya', 
    date: '31 Ocak 1906', 
    magnitude: 8.8, 
    coordinates: [1.0, -81.5], 
    location: 'Ekvador',
    fault: 'Nazca - Güney Amerika Levha Sınırı',
    details: 'Güney Amerika\'nın kuzeybatı kıyısında gerçekleşen mega bindirme depremidir. Bölgedeki sismik boşluk tartışmalarının merkezindedir.'
  },
  
  // --- Kuzey Amerika ---
  { 
    id: 11, 
    name: 'Büyük Alaska Depremi', 
    date: '27 Mart 1964', 
    magnitude: 9.2, 
    coordinates: [61.0, -147.7], 
    location: 'Alaska, ABD',
    fault: 'Aleut Yitim Zonu',
    details: 'Kuzey Amerika tarihinin en büyük, dünyanın ise ikinci en büyük depremidir. Sarsıntı 4.5 dakika sürmüştür. Toprak sıvılaşması ve devasa heyelanlar (Turnagain Heights) görülmüştür.'
  },
  { 
    id: 12, 
    name: 'San Francisco Depremi', 
    date: '18 Nisan 1906', 
    magnitude: 7.9, 
    coordinates: [37.7, -122.5], 
    location: 'California, ABD',
    fault: 'San Andreas Fayı',
    details: 'Modern deprem biliminin doğuşuna öncülük etmiştir (Elastik Geri Sekme Teorisi). Depremden çok, sonrasında çıkan ve günlerce süren yangınlar şehri yok etmiştir.'
  },
  
  // --- Asya & Okyanusya ---
  { 
    id: 15, 
    name: 'Tohoku (Büyük Doğu Japonya)', 
    date: '11 Mart 2011', 
    magnitude: 9.1, 
    coordinates: [38.3, 142.4], 
    location: 'Japonya',
    fault: 'Japonya Çukuru',
    details: 'Japonya tarihinin en büyük depremidir. Yarattığı 40 metreyi bulan tsunami, Fukuşima Nükleer Santrali kazasına neden olmuştur. Dünyanın eksenini kaydırdığı hesaplanmıştır.'
  },
  { 
    id: 17, 
    name: 'Sumatra - Andaman', 
    date: '26 Aralık 2004', 
    magnitude: 9.1, 
    coordinates: [3.3, 95.8], 
    location: 'Endonezya',
    fault: 'Sunda Yitim Zonu',
    details: 'Hint Okyanusu\'ndaki en büyük felakettir. 10 dakikaya yakın süren sarsıntı, modern tarihin en uzun süreli depremidir. 14 ülkede 230.000\'den fazla insan tsunami nedeniyle hayatını kaybetmiştir.'
  },
  { 
    id: 21, 
    name: 'Nepal (Gorkha) Depremi', 
    date: '25 Nisan 2015', 
    magnitude: 7.8, 
    coordinates: [28.2, 84.7], 
    location: 'Nepal',
    fault: 'Ana Himalaya Bindirme Fayı (MHT)',
    details: 'Hindistan Levhasının Avrasya Levhasının altına daldığı hat üzerinde gerçekleşmiştir. Everest Dağı\'nda çığ düşmesine neden olmuş ve Katmandu Vadisi\'ndeki tarihi yapıları yıkmıştır.'
  }
];

export default function TurkiyeDepremHaritasi() {
  const [selectedFeature, setSelectedFeature] = useState(null);
  const [viewMode, setViewMode] = useState('world');
  const [activeLayers, setActiveLayers] = useState({ faults: true, quakes: true, gaps: false });
  const [sidebarOpen, setSidebarOpen] = useState(false);
  
  const mapContainerRef = useRef(null);
  const mapInstanceRef = useRef(null);
  const layersRef = useRef({ faults: [], quakes: [], gaps: [] });
  const isLeafletLoaded = useRef(false);

  useEffect(() => {
    if (isLeafletLoaded.current) return;
    const link = document.createElement("link");
    link.rel = "stylesheet";
    link.href = "https://unpkg.com/leaflet@1.9.3/dist/leaflet.css";
    document.head.appendChild(link);
    const script = document.createElement("script");
    script.src = "https://unpkg.com/leaflet@1.9.3/dist/leaflet.js";
    script.async = true;
    script.onload = () => {
      isLeafletLoaded.current = true;
      initMap();
    };
    document.body.appendChild(script);
  }, []);

  const initMap = () => {
    if (!window.L || mapInstanceRef.current) return;
    const map = window.L.map(mapContainerRef.current).setView([25.0, 0.0], 2);
    window.L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
      attribution: '&copy; OpenStreetMap &copy; CARTO',
      subdomains: 'abcd',
      maxZoom: 19,
      minZoom: 2,
      noWrap: true
    }).addTo(map);
    mapInstanceRef.current = map;
    updateLayers();
  };

  const updateLayers = () => {
    const map = mapInstanceRef.current;
    const L = window.L;
    if (!map || !L) return;

    ['faults', 'quakes', 'gaps'].forEach(key => {
      layersRef.current[key].forEach(layer => map.removeLayer(layer));
      layersRef.current[key] = [];
    });

    if (activeLayers.faults) {
      faultLines.forEach(fault => {
        const options = { color: fault.color, weight: 2, opacity: 0.7 };
        const createPolyline = (coords) => {
          const polyline = L.polyline(coords, options).addTo(map);
          polyline.on('click', () => handleFeatureClick(fault, 'fault'));
          polyline.bindTooltip(`${fault.name}`, { sticky: true });
          layersRef.current.faults.push(polyline);
        };
        if (Array.isArray(fault.coordinates[0][0])) {
          fault.coordinates.forEach(segment => createPolyline(segment));
        } else {
          createPolyline(fault.coordinates);
        }
      });
    }

    if (activeLayers.gaps) {
      seismicGaps.forEach(gap => {
        const glow = L.polyline(gap.coordinates, { color: '#d946ef', weight: 10, opacity: 0.3 }).addTo(map);
        const line = L.polyline(gap.coordinates, { color: '#d946ef', weight: 4, dashArray: '10,10', className: 'animate-pulse' }).addTo(map);
        line.on('click', () => handleFeatureClick(gap, 'gap'));
        layersRef.current.gaps.push(glow, line);
      });
    }

    if (activeLayers.quakes) {
      earthquakes.forEach(quake => {
        let color = quake.magnitude >= 9.0 ? '#be123c' : (quake.magnitude >= 8.0 ? '#ef4444' : '#f97316');
        if (quake.id > 100) {
          color = '#00ffff'; 
        }
        
        const marker = L.circleMarker(quake.coordinates, {
          color: color, fillColor: color, fillOpacity: 0.8, radius: quake.magnitude * 1.5
        }).addTo(map);
        marker.on('click', () => handleFeatureClick(quake, 'quake'));
        layersRef.current.quakes.push(marker);
      });
    }
  };

  useEffect(() => { updateLayers(); }, [activeLayers]);
  
  useEffect(() => {
    const map = mapInstanceRef.current;
    if (!map) return;
    if (viewMode === 'turkey') map.setView([39.0, 35.0], 6);
    else map.setView([25.0, 0.0], 2);
  }, [viewMode]);

  const toggleLayer = (l) => setActiveLayers(p => ({...p, [l]: !p[l]}));
  const handleFeatureClick = (f, t) => { setSelectedFeature({...f, dataType: t}); setSidebarOpen(true); };
  const handleViewChange = () => setViewMode(p => p === 'turkey' ? 'world' : 'turkey');

  return (
    <div className="flex flex-col h-screen w-full bg-gray-900 text-white font-sans overflow-hidden relative">
      {/* Header */}
      <header className="bg-gray-800 p-3 shadow-lg z-20 flex flex-wrap gap-2 justify-between items-center border-b border-gray-700">
        <div className="flex items-center gap-2">
          <Globe className="text-blue-500" size={20} />
          <div>
            <h1 className="text-base sm:text-lg font-bold leading-tight">Dünya Tektonik Atlası</h1>
          </div>
        </div>
        <div className="flex gap-2 overflow-x-auto pb-1 sm:pb-0">
          <button onClick={() => toggleLayer('faults')} className={`px-2 py-1 rounded text-xs flex items-center gap-1 border ${activeLayers.faults ? 'bg-blue-900/60 border-blue-500 text-blue-100' : 'bg-gray-700 border-gray-600 text-gray-400'}`}>
            <Activity size={14} /> Faylar
          </button>
          <button onClick={() => toggleLayer('gaps')} className={`px-2 py-1 rounded text-xs flex items-center gap-1 border ${activeLayers.gaps ? 'bg-purple-900/60 border-purple-500 text-purple-100 animate-pulse' : 'bg-gray-700 border-gray-600 text-gray-400'}`}>
            <Clock size={14} /> Riskli Bölgeler
          </button>
          <button onClick={() => toggleLayer('quakes')} className={`px-2 py-1 rounded text-xs flex items-center gap-1 border ${activeLayers.quakes ? 'bg-red-900/60 border-red-500 text-red-100' : 'bg-gray-700 border-gray-600 text-gray-400'}`}>
            <AlertTriangle size={14} /> 7.0+ Depremler
          </button>
          <button onClick={handleViewChange} className="ml-2 px-3 py-1 rounded bg-indigo-600 hover:bg-indigo-500 text-white text-xs font-bold whitespace-nowrap">
            {viewMode === 'turkey' ? 'Dünya' : 'Türkiye'}
          </button>
        </div>
      </header>

      <div className="flex-1 relative flex">
        <div className="flex-1 bg-gray-900 z-0">
          <div ref={mapContainerRef} className="h-full w-full" style={{zIndex: 0}}></div>
          
          <div className="absolute bottom-6 left-4 bg-gray-800/80 backdrop-blur p-2 rounded border border-gray-600 text-[10px] sm:text-xs z-[400] shadow-xl pointer-events-none">
            <div className="flex items-center gap-2 mb-1"><span className="w-3 h-1 bg-red-500"></span> Yitim Zonu / Aktif</div>
            <div className="flex items-center gap-2 mb-1"><span className="w-3 h-1 bg-blue-500"></span> Okyanus Sırtı</div>
            <div className="flex items-center gap-2 mb-1"><span className="w-3 h-1 bg-purple-500 border-b border-dotted"></span> Yüksek Risk (Boşluk)</div>
            <div className="flex items-center gap-2"><span className="w-3 h-3 rounded-full bg-cyan-400 opacity-80"></span> 2024-2025 Güncel</div>
          </div>
        </div>

        <div className={`absolute top-0 right-0 h-full w-full sm:w-80 bg-gray-900/95 backdrop-blur border-l border-gray-700 shadow-2xl transform transition-transform duration-300 z-[500] overflow-y-auto ${sidebarOpen ? 'translate-x-0' : 'translate-x-full'}`}>
          {selectedFeature && (
            <div className="p-5">
              <button onClick={() => setSidebarOpen(false)} className="absolute top-3 right-3 text-gray-400 hover:text-white"><X size={20}/></button>
              
              <div className="mb-4">
                <span className={`text-xs font-bold px-2 py-0.5 rounded border uppercase tracking-wider ${selectedFeature.dataType === 'gap' ? 'text-purple-300 border-purple-500 bg-purple-900/30' : (selectedFeature.dataType === 'quake' ? 'text-red-300 border-red-500 bg-red-900/30' : 'text-blue-300 border-blue-500 bg-blue-900/30')}`}>
                  {selectedFeature.dataType === 'gap' ? 'Sismik Boşluk' : (selectedFeature.dataType === 'quake' ? 'Deprem Kaydı' : 'Fay Hattı')}
                </span>
              </div>
              
              <h2 className="text-xl font-bold mb-2">{selectedFeature.name}</h2>
              
              {selectedFeature.dataType === 'quake' ? (
                <div className="space-y-4">
                  <div className="bg-gray-800 p-3 rounded border border-gray-700">
                    <div className="flex justify-between mb-2 border-b border-gray-700 pb-2">
                      <span className="text-gray-400 text-sm">Büyüklük</span>
                      <span className="text-red-400 font-bold text-lg">M{selectedFeature.magnitude}</span>
                    </div>
                    <div className="flex justify-between">
                      <span className="text-gray-400 text-sm">Tarih</span>
                      <span>{selectedFeature.date}</span>
                    </div>
                    <div className="mt-2 text-sm text-gray-300 flex items-start gap-2">
                         <MapIcon size={14} className="mt-1 flex-shrink-0" />
                         {selectedFeature.location}
                    </div>
                    {selectedFeature.id > 100 && (
                       <div className="mt-3 text-xs text-cyan-300 border border-cyan-900 bg-cyan-900/20 p-2 rounded">
                         ⚠️ Bu deprem 2024-2025 yılları arasında gerçekleşen güncel bir olaydır.
                       </div>
                    )}
                  </div>

                  {selectedFeature.fault && (
                    <div className="bg-blue-900/20 border border-blue-800 p-3 rounded">
                       <div className="text-xs text-blue-300 uppercase font-bold mb-1 flex items-center gap-1">
                         <Activity size={12} /> İlgili Fay / Mekanizma
                       </div>
                       <div className="text-sm font-semibold text-white">{selectedFeature.fault}</div>
                    </div>
                  )}

                  {selectedFeature.details && (
                    <div>
                      <div className="text-xs text-gray-400 uppercase font-bold mb-2 flex items-center gap-1">
                        <FileText size={12} /> Tarihçe & Detaylar
                      </div>
                      <p className="text-sm text-gray-300 leading-relaxed border-l-2 border-gray-600 pl-3 bg-gray-800/40 p-2 rounded-r">
                        {selectedFeature.details}
                      </p>
                    </div>
                  )}
                </div>
              ) : (
                <div className="space-y-4">
                  <div className="flex gap-2 flex-wrap">
                    <span className="px-2 py-1 bg-gray-800 rounded text-xs text-gray-300 border border-gray-700">{selectedFeature.region}</span>
                    {selectedFeature.type && <span className="px-2 py-1 bg-gray-800 rounded text-xs text-gray-300 border border-gray-700">{selectedFeature.type}</span>}
                  </div>
                  
                  {selectedFeature.riskLevel && (
                    <div className="bg-purple-900/20 border border-purple-500/50 p-3 rounded">
                      <div className="text-xs text-purple-300 uppercase font-bold mb-1">Risk Seviyesi</div>
                      <div className="text-lg font-bold">{selectedFeature.riskLevel}</div>
                      <div className="text-sm text-gray-300 mt-1">Olasılık: {selectedFeature.probability}</div>
                    </div>
                  )}

                  <div>
                    <h3 className="text-sm font-bold text-gray-400 uppercase mb-1">Açıklama</h3>
                    <p className="text-sm text-gray-200 leading-relaxed">{selectedFeature.description}</p>
                  </div>
                  
                  {(selectedFeature.history || selectedFeature.status) && (
                    <div>
                      <h3 className="text-sm font-bold text-gray-400 uppercase mb-1">{selectedFeature.dataType === 'gap' ? 'Durum' : 'Tarihçe'}</h3>
                      <p className="text-sm text-gray-300 leading-relaxed border-l-2 border-gray-600 pl-3">
                        {selectedFeature.history || selectedFeature.status}
                      </p>
                    </div>
                  )}
                </div>
              )}
            </div>
          )}
        </div>
      </div>
    </div>
  );
}
